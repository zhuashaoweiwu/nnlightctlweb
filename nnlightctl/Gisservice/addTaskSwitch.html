<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>灯具道路地理信息--新建任务开关</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css" />
    <link rel="stylesheet" type="text/css" href="../css/admin.css" />
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css" />
</head>
<body>
    <div class="page-container">
        <form class="form form-horizontal" id="form-admin-add">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3 text-r"><span class="c-red">*</span>任务开关名称：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="" placeholder="任务开关名称" id="switchName" name="switchName">
            </div>
        </div>
        <!--<div class="row cl mt-10">-->
            <!--<label class="form-label col-xs-4 col-sm-3 text-r"><span class="c-red">*</span>描述：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-9">-->
                <!--<textarea cols="" rows="" class="textarea" placeholder="说点什么...100个字符以内" dragonfly="true" id="mem" name="mem"></textarea>-->
            <!--</div>-->
        <!--</div>-->
        <div class="row cl mt-10">
            <label class="form-label col-xs-4 col-sm-3 text-r"><span class="c-red">*</span>定时设置：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" style="width:150px;" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'08:00:00',quickSel:['%H-00-00','%H-15-00','%H-30-00','%H-45-00']})" id="startTime" placeholder="开始时间">
                -
                <input type="text" class="input-text" style="width:150px;" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'08:00:00',quickSel:['%H-00-00','%H-15-00','%H-30-00','%H-45-00']})" id="endTime" placeholder="结束时间">
            </div>
        </div>
        <div class="row cl mt-10">
            <label class="form-label col-xs-4 col-sm-3 text-r">是否启用光照计：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="select-box" style="width:150px;">
                    <select class="select" name="isUsebeam" id="isUsebeam" size="1">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </span>
            </div>
        </div>
        <div class="row cl mt-10">
            <label class="form-label col-xs-4 col-sm-3 text-r">是否开灯：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="select-box" style="width:150px;">
                    <select class="select" name="isLighton" id="isLighton">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </span>
             </div>
        </div>
        <div class="row cl mt-10">
            <label class="form-label col-xs-4 col-sm-3 text-r"><span class="c-red">*</span>周期：</label>
            <div class="formControls col-xs-8 col-sm-9">
            <span class="select-box" id="period" name="period" style="width:200px;">
                <label><input name="period1" id="period1" type="checkbox" value="1" />平常 </label>
                <label><input name="period2"  id="period2" type="checkbox" value="2" />周末 </label>
                <label><input name="period3"  id="period3" type="checkbox" value="4" />节假日 </label>
            </span>
            </div>
        </div>
        <!--<div class="row cl mt-10">-->
            <!--<label class="form-label col-xs-4 col-sm-3 text-r">经度：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-4">-->
                <!--<input type="text" class="input-text" value="" placeholder="经度" id="longitude" name="longitude" >-->
            <!--</div>-->
        <!--</div>-->
        <!--<div class="row cl mt-10">-->
            <!--<label class="form-label col-xs-4 col-sm-3 text-r">纬度：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-4">-->
                <!--<input type="text" class="input-text" value="" placeholder="纬度" id="latitude" name="latitude">-->
            <!--</div>-->
        <!--</div>-->
        <div class="row cl mt-10">
            <label class="form-label col-xs-4 col-sm-3 text-r">调光控制：</label>
            <div class="formControls col-xs-8 col-sm-4">
                <input type="text" class="input-text" value="" placeholder="调光控制百分比" id="lightPercent" name="lightPercent">
            </div>
        </div>
        <div class="row cl mt-20">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
        </form>
    </div>

    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <script type="text/javascript" src="../js/admin.js"></script>

    <script type="text/javascript" src="../js/api/requestRoot.js"></script>
    <script type="text/javascript" src="../js/api/ajaxScript.js"></script>
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="../lib/layer/2.4/layer.js"></script><!--弹出插件-->
    <script type="text/javascript" src="../lib/My97DatePicker/4.8/WdatePicker.js"></script> <!--日期插件-->

    <!--/_footer 作为公共模版分离出去-->
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="../lib/jquery.validation/1.14.0/jquery.validate.js"></script>
    <script type="text/javascript" src="../lib/jquery.validation/1.14.0/validate-methods.js"></script>
    <script type="text/javascript" src="../lib/jquery.validation/1.14.0/messages_zh.js"></script>
    <script type="text/javascript">
        $(function () {
            $('.skin-minimal input').iCheck({
                checkboxClass: 'icheckbox-blue',
                radioClass: 'iradio-blue',
                increaseArea: '20%'
            });

            //数据验证
            $("#form-admin-add").validate({
                rules: {
                    taskSwitch: {
                        required: true,
                        minlength: 1,
                        maxlength: 64
                    }
                },
                onkeyup: false,
                focusCleanup: true,
                success: "valid",
                submitHandler: function (form) {
                    //ajax上传表单
                    //构造上传数据
                    var param = {};
                    var paramArray = $(form).serializeArray();
                    var isLighton = $("#isLighton").val();
                    var isUsebeam = $("#isUsebeam").val();
                    var startTime = $("#startTime").val();
                    var endTime = $("#endTime").val();
                    for (var i = 0; i < paramArray.length; ++i) {
                        var o = paramArray[i];
                        param[o["name"]] = o["value"];
                    }
                    if(isLighton == 0){
                        param["isLighton"] = 0
                    }else {
                        param["isLighton"] = 1
                    }
                    if(isUsebeam == 0){
                        param["isUsebeam"] = 0
                    }else {
                        param["isUsebeam"] = 1
                    }
                    var period = ($("#period3").is(":checked")?"1":"0") + ($("#period2").is(":checked")?"1":"0") + ($("#period1").is(":checked")?"1":"0" ) ;
                    // console.info(period);
                    param["period"] = parseInt(period ,2);
                    var startdate = str2Date($("#startTime").val());
                    var enddate = str2Date($("#endTime").val());

                    param["startTime"]=startdate;
                    param["endTime"]=enddate;

                    param["id"] = editModel(window.location.href);
                    // console.log(param)
                    ajaxRequest("post", "/api/switchTask/addOrUpdateSwitchTask", param, function (data) {
                        if (data) {
                            if (data.header.code == 1000) {

                                if (editModel(window.location.href)) {
                                    layer.msg("编辑任务开关信息成功！", {icon : 1, time : 3000});
                                } else {
                                    layer.msg("添加任务开关信息成功！", {icon : 1, time : 3000});
                                }
                            } else {
                                layer.msg(data.header.msg, {icon : 2, time : 3000});
                            }
                        }
                    });
                    ResetWindow();
                }
            });

            //判断是否编辑模式
            var id = editModel(window.location.href);
            console.log(id);
            if (id) {
                ajaxRequest("post", "/api/switchTask/getSimpleSwitchTask", {"id" : id}, function (data) {
                    if (data) {
                        if (data.header.code == 1000) {
                            var taskSwitch = data.body.data[0];
                            var tp=taskSwitch.period;
                            if((tp&1)==1){
                                $("#period1").attr("checked",true);
                            }else if((tp&1)==0){
                                $("#period1").attr("checked",false);
                            }
                            if((tp&2)==2){
                                $("#period2").attr("checked",true);
                            }else if((tp&2)==0){
                                $("#period2").attr("checked",false);
                            }
                            if((tp&4)==4){
                                $("#period3").attr("checked",true);
                            }else if((tp&4)==0){
                                $("#period3").attr("checked",false);
                            }
                            // switch (taskSwitch.period){
                            //     case 1:
                            //         $("#period1").attr("checked",true);
                            //         break;
                            //     case 2:
                            //         $("#period2").attr("checked",true);
                            //         break;
                            //     case 3:
                            //         $("#period1").attr("checked",true);
                            //         $("#period2").attr("checked",true);
                            //         break;
                            //     case 4:
                            //         $("#period3").attr("checked",true);
                            //         break;
                            //     case 5:
                            //         $("#period1").attr("checked",true);
                            //         $("#period3").attr("checked",true);
                            //         break;
                            //     case 6:
                            //         $("#period2").attr("checked",true);
                            //         $("#period3").attr("checked",true);
                            //         break;
                            //     case 7:
                            //         $("#period1").attr("checked",true);
                            //         $("#period2").attr("checked",true);
                            //         $("#period3").attr("checked",true);
                            //         break;
                            //
                            // }
                            //刷新表单
                            $("#switchName").val(taskSwitch.switchName);
                            $("#mem").val(taskSwitch.mem);
                            $("#startTime").val(transDate(taskSwitch.startTime));
                            $("#endTime").val(transDate(taskSwitch.endTime));
                            $("#isLighton").val(taskSwitch.isLighton);
                            $("#isUsebeam").val(taskSwitch.isUsebeam);
                            $("#period").val(taskSwitch.period);
                            $("#lightPercent").val(taskSwitch.lightPercent);

                        } else {
                            layer.msg(data.header.msg, {icon : 2});
                        }
                    }
                });
            }
        });
    </script>

</body>
</html>
