<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>道路照明系统</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css" />
    <link rel="stylesheet" type="text/css" href="../css/admin.css" />
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css" />
</head>
<body>
    <nav class="breadcrumb">
        <i class="Hui-iconfont">&#xe67f;</i> 首页
        <span class="c-gray en">&gt;</span>
        道路照明系统
        <span class="c-gray en">&gt;</span>
        部署
        <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a>
    </nav>
    <div class="page-container">
        
            <div id="tab-system" class="HuiTab">
                <div class="tabBar cl">
                    <span>控制柜模式</span>
                    <span>灯具模式</span>
                </div>
                <!-- 控制柜面板 -->
                <div class="tabCon mt-30">
                    <div class="text-l">
                        控制柜：
                        <input type="text" name="uid" id="uid" placeholder="控制柜" style="width:250px" class="input-text">
                        <span class="pl-20">名称：</span>
                        <input type="text" name="codeNumber" id="codeNumber" placeholder="名称" style="width:250px" class="input-text">
                        <button name="" id="Button1" class="btn btn-success f-r" type="submit"><i class="Hui-iconfont">&#xe665;</i>控制柜</button>
                    </div>
                    <div class="cl pd-5 bg-1 bk-gray mt-20">
                        <ul class="cl tabnav">
                            <li><a href="javascript:void(0);" onclick="del_more_elebox()" class="btn btn-danger radius mr-10"><i class="Hui-iconfont">&#xe6e2;</i>批量删除</a></li>
                            <!--<li><a href="javascript:void(0);" onclick="project_del_more()" class="btn btn-secondary radius mr-10"><i class="Hui-iconfont">&#xe645;</i>导入</a></li>
                            <li><a href="javascript:void(0);" onclick="project_del_more()" class="btn btn-success radius mr-10"><i class="Hui-iconfont">&#xe644;</i>导出</a></li>-->
                            <li class="dropDown dropDown_hover">
                                <a href="#" class="btn btn-danger radius mr-10">批量设置<i class="Hui-iconfont">&#xe6d5;</i></a>
                                <ul class="dropDown-menu menu radius box-shadow">
                                    <li><a href="javascript:void(0);" onclick="setArea('设置区域', 'setArea.html', '500', '300')">设置区域</a></li>
                                    <!--<li><a href="javascript:void(0);" onclick="setMappic('设置地图图标', 'setMappic.html', '500', '300')">设置地图图标</a></li>-->
                                </ul>
                            </li>
                            <li><a class="btn btn-primary radius" data-title="添加控制柜" onclick="addEleBox('添加控制柜', 'addEleBox.html', '1300', '750')" href="javascript:void(0);"><i class="Hui-iconfont">&#xe600;</i>添加控制柜</a></li>
                         </ul>
                    </div>
                    <div class="mt-20">
                        <table class="table table-border table-bordered table-bg table-hover table-sort table-responsive">
                            <thead>
                                <tr class="text-c">
                                    <th width="25"><input type="checkbox" name="" value=""></th>
                                    <th width="100">区域</th>
                                    <th width="100">安装日期</th>
                                    <th width="100">额定电压</th>
                                    <th width="100">额定电流</th>
                                    <th width="100">额定功率</th>
                                    <th width="100">主控制开关</th>
                                    <th width="100">spd</th>
                                    <th width="100">经度</th>
                                    <th width="100">纬度</th>
                                    <th width="120">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-c">
                                    <td><input type="checkbox" value="" name=""></td>
                                    <td>001111</td>
                                    <td>2018-10-20</td>
                                    <td>320.56</td>
                                    <td>13.22</td>
                                    <td>90.56</td>
                                    <td>主控制开关</td>
                                    <td>spd防电涌</td>
                                    <td>120.1245786</td>
                                    <td>31.1245786</td>
                                    <td class="f-14 td-manage">
                                        <a style="text-decoration:none" class="ml-5" onclick="lampsManage('管理灯具', 'LampsManage.html', '1200', '800')" href="javascript:void(0);" title="管理灯具"><i class="Hui-iconfont">&#xe61d;</i></a> 
                                        <a style="text-decoration:none" class="ml-5" onclick="editElebox('控制柜编辑', 'editElebox.html', '1', '800', '500')" href="javascript:void(0);" title="控制柜编辑"><i class="Hui-iconfont">&#xe6df;</i></a> 
                                        <a style="text-decoration:none" class="ml-5" onClick="delElebox(this, '10001')" href="javascript:void(0);" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
              </div>
                <!-- 灯具面板 -->
                <div class="tabCon mt-30">
                    <div class="text-l">
                        UUID：
                        <input type="text" name="uuid" id="uuid" placeholder="灯杆" style="width:250px" class="input-text">
                        <span class="pl-20">灯具唯一编码：</span>
                        <input type="text" name="lightingCode" id="lightingCode" placeholder="灯头号" style="width:250px" class="input-text">
                        <button name="" id="btnLightSearch" class="btn btn-success f-r" type="submit"><i class="Hui-iconfont">&#xe665;</i>灯具</button>
                    </div>
                    <div class="cl pd-5 bg-1 bk-gray mt-20">
                        <ul class="cl tabnav">
                            <li><a href="javascript:void(0);" onclick="del_more_light()" class="btn btn-danger radius mr-10"><i class="Hui-iconfont">&#xe6e2;</i>批量删除</a></li>
                            <!--<li><a href="javascript:void(0);" onclick="project_del_more()" class="btn btn-secondary radius mr-10"><i class="Hui-iconfont">&#xe645;</i>导入</a></li>
                            <li><a href="javascript:void(0);" onclick="project_del_more()" class="btn btn-success radius mr-10"><i class="Hui-iconfont">&#xe644;</i>导出</a></li>-->
                            <li class="dropDown dropDown_hover">
                                <a href="#" class="btn btn-danger radius mr-10">批量设置<i class="Hui-iconfont">&#xe6d5;</i></a>
                                <ul class="dropDown-menu menu radius box-shadow">
                                    <li><a href="javascript:void(0);" onclick="setArea('设置区域', 'setArea.html', '600', '400')">设置区域</a></li>
                                    <!--<li><a href="javascript:void(0);" onclick="setEleBox('设置所属控制柜', 'setEleBox.html', '500', '300')">设置所属控制柜</a></li>
                                    <li><a href="javascript:void(0);" onclick="setMappic('设置地图图标', 'setMappic.html', '500', '300')">设置地图图标</a></li>-->
                                </ul>
                            </li>
                            <li><a class="btn btn-primary radius mr-10" data-title="添加灯具" onclick="addLamps('添加灯具', 'addLamps.html', '800', '550')" href="javascript:void(0);"><i class="Hui-iconfont">&#xe600;</i>添加灯具</a></li>
                            <li><a class="btn btn-primary radius" data-title="批量添加灯具" onclick="addLampsMore('批量添加灯具', 'addLampsMore.html', '1050', '550')" href="javascript:void(0);"><i class="Hui-iconfont">&#xe600;</i>批量添加灯具</a></li>
                        </ul>
                        
                    </div>
                    <div class="mt-20">
                        <table id="lightTable" class="table table-border table-bordered table-bg table-hover table-sort table-responsive">
                            <thead>
                                <tr class="text-c">
                                    <th width="25"><input type="checkbox" name="" value=""></th>
                                    <th width="160">编码</th>
                                    <th width="260">UUID</th>
                                    <th width="100">灯头号</th>
                                    <th width="100">灯杆</th>
                                    <th width="80">光衰</th>
                                    <th width="140">最大使用时间（年）</th>
                                    <th>备注</th>
                                    <th width="120">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-c">
                                    <td><input type="checkbox" value="" name=""></td>
                                    <td>10001</td>
                                    <td>abcdefg-hijklmn-opq-rst-uvw-xyz-1234</td>
                                    <td>灯头号</td>
                                    <td>灯杆</td>
                                    <td>光衰</td>
                                    <td>30年</td>
                                    <td class="text-l">判断灯具UID是否重复判断灯具UID是否重复判断灯具UID是否重复</td>
                                    <td class="f-14 td-manage" style="background:#fff;">
                                    <a style="text-decoration:none" class="ml-5" onclick="editLamps('灯具编辑', 'addLamps.html', '1', '800', '500')" href="javascript:void(0);" title="灯具编辑"><i class="Hui-iconfont">&#xe6df;</i></a>
                                    <a style="text-decoration:none" class="ml-5" onClick="delLamps(this, '10001')" href="javascript:void(0);" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
    </div>

    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <script type="text/javascript" src="../js/admin.js"></script>

    <script type="text/javascript" src="../js/api/requestRoot.js"></script>
    <script type="text/javascript" src="../js/api/ajaxScript.js"></script>
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="../lib/layer/2.4/layer.js"></script><!--弹出插件-->
    <script type="text/javascript">
        $(function () {
            //tab切换
	        $("#tab-system").Huitab({
	            index:0//默认第一个；
	        });

	        //搜索灯具列表
            searchLight();

            //灯具搜索按扭点击事件
            $("#btnLightSearch").click(function () {
                searchLight();
            });
        });
        function del_more_elebox()
        {
            //批量删除
        }
        //管理灯具
        function lampsManage(title, url, w, h) {
            layer_show(title, url, w, h);
        }
        //添加控制柜
        function addEleBox(title, url, w, h) {
            layer_show(title, url, w, h);
        }
        //编辑控制柜
        function editElebox(title, url,id, w, h) {
            layer_show(title, url, w, h);
        }
        /*删除控制柜*/
        function delElebox(obj, id) {
            layer.confirm('确认要删除吗？', function (index) {
                // var id = $(obj).parents("tr").find("input[type='checkbox']").eq(0).val();
                var idArray = [];
                idArray.push(id);
                batchDeleteProject(idArray);
                layer.close(index);
            });
        }
        //批量添加灯具
        function addLampsMore(title, url, w, h) {
            layer_show(title, url, w, h);
        }
        //添加灯具
        function addLamps(title, url, w, h) {
            layer_show(title, url, w, h);
        }
        //编辑灯具
        function editLamps(title, url, id, w, h) {
            layer_show(title, url + "?id=" + id, w, h);
        }

        /*批量删除灯具*/
        function batchDeleteLight(idArray) {
            if (!idArray) {
                return;
            }

            ajaxRequest("post", "/api/roadlighting/deleteLighting", transArray({deleteLightIdList : idArray}), function (data) {
                if (data) {
                    if (data.header.code == 1000) {
                        searchLight();
                    } else {
                        layer.msg(data.header.msg, { icon: 2, time: 3000 });
                    }
                }
            });
        }
        //批量删除灯具函数
        function del_more_light() {
            //获取全部批量删除的id
            var idArray = [];
            $("#lightTable").find("input[type='checkbox']:checked").each(function () {
                idArray.push($(this).val());
            });

            if (idArray.length <= 0) {
                return;
            }

            layer.confirm('确认批量删除？', function (index) {
                batchDeleteLight(idArray);
                layer.close(index);
            })
        }
        //删除灯具
        function delLamps(obj, id) {
            layer.confirm('确认要删除吗？', function (index) {
                // var id = $(obj).parents("tr").find("input[type='checkbox']").eq(0).val();
                var idArray = [];
                idArray.push(id);
                batchDeleteLight(idArray);
                layer.close(index);
            });
        }
        //设置区域
        function setArea(title, url, w, h) {
            layer_show(title, url, w, h, function (data) {
                console.log("the select area id is : " + data);
            });
        }
        //设置区域
        function setEleBox(title, url, w, h) {
            layer_show(title, url, w, h);
        }
        //设置区域
        function setMappic(title, url, w, h) {
            layer_show(title, url, w, h);
        }
        
        //通过搜索条件查询灯具列表集合
        function searchLight() {
            //获取搜索条件
            var searchUUID = $("#uuid").val().trim();
            var searchLightingCode = $("#lightingCode").val().trim();

            //搜索
            ajaxRequest("post", "/api/roadlighting/listLighting", {"uuid" : searchUUID, "lightingCode" : searchLightingCode},
                function (data) {
                    if (data) {
                        if (data.header.code == 1000) {
                            var lightArray = data.body.data;
                            var $tbody = $("#lightTable").find("tbody").eq(0);
                            $tbody.empty();

                            for (var i = 0; i < lightArray.length; ++i) {
                                var light = lightArray[i];
                                $('<tr class="text-c">\n' +
                                    '<td><input type="checkbox" value="'+light.id+'" name=""></td>\n' +
                                    '<td>'+light.lightingCode+'</td>\n' +
                                    '<td>'+light.uid+'</td>\n' +
                                    '<td>'+light.lamphead+'</td>\n' +
                                    '<td>'+light.lamppost+'</td>\n' +
                                    '<td>'+light.decay+'</td>\n' +
                                    '<td>'+light.maxUseTime+'</td>\n' +
                                    '<td class="text-l">'+light.mem+'</td>\n' +
                                    '<td class="f-14 td-manage" style="background:#fff;">\n' +
                                    '<a style="text-decoration:none" class="ml-5" onclick="editLamps(\'灯具编辑\', \'addLamps.html\', \''+light.id+'\', \'800\', \'500\')" href="javascript:void(0);" title="灯具编辑"><i class="Hui-iconfont">&#xe6df;</i></a> \n' +
                                    '<a style="text-decoration:none" class="ml-5" onClick="delLamps(this, \''+light.id+'\')" href="javascript:void(0);" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>\n' +
                                    '</tr>').appendTo($tbody);
                            }
                        } else {
                            layer.msg(data.header.msg, {icon : 2, time : 3000});
                        }
                    }
            });
        }
    </script>
</body>
</html>
