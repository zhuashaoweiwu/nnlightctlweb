<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <title>部署 -- 编辑控制柜</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../css/admin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css"/>

</head>
<body>
<article class="page-container">
    <form class="form form-horizontal" id="form-admin-add">

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">控制柜UUID：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="" placeholder="控制柜UUID" id="uid" name="uid">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">网卡地址：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="" placeholder="网卡地址" id="networkAddr" name="networkAddr">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>控制柜唯一编码：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="" placeholder="控制柜唯一编码" id="codeNumber" name="codeNumber">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">控制柜生产日期：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text Wdate"
                       onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'manufacture\')||\'%y-%M-%d\'}' })" value=""
                       placeholder="配电柜生产日期" id="manufacture" name="manufacture">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">经度：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text" value="" placeholder="经度" id="longitude" name="longitude">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">纬度：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text" value="" placeholder="纬度" id="latitude" name="latitude">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">配电柜使用日期：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text Wdate"
                       onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'useDate\')||\'%y-%M-%d\'}' })" value=""
                       placeholder="配电柜使用日期" id="useDate" name="useDate">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">额定电压：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text" value="" placeholder="额定电压" id="ratedVoltage" name="ratedVoltage">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">额定电流：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text" value="" placeholder="额定电流" id="ratedElectricty"
                       name="ratedElectricty">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">额定功率：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text" value="" placeholder="额定功率" id="powerRating" name="powerRating">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">最大使用时间：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                <input type="text" class="input-text" value="" placeholder="最大使用时间" id="maxUseTime" name="maxUseTime">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">spd描述：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="" placeholder="spd描述" id="spd" name="spd">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">主进线开关型号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="" placeholder="主进线开关型号" id="mainSwitch" name="mainSwitch">
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">控制柜区域：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" regionId="" value="" placeholder="控制柜区域" id="nnlightctlRegionId"
                       name="nnlightctlRegionId">
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属项目：</label>
            <div class="formControls col-xs-8 col-sm-9" style="width:200px;">
                    <span class="select-box" style="width:150px;">
                        <select class="select" name="nnlightctlProjectId" id="nnlightctlProjectId" size="1">
                            <option value="0">请选择所属项目</option>
                        </select>
                    </span>
            </div>
        </div>

        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input id="btnSubmit" class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</article>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="../js/admin.js"></script>
<script type="text/javascript" src="../lib/My97DatePicker/4.8/WdatePicker.js"></script> <!--日期插件-->

<script type="text/javascript" src="../js/api/requestRoot.js"></script>
<script type="text/javascript" src="../js/api/ajaxScript.js"></script>
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script><!--弹出插件-->

<script type="text/javascript" src="../lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript">
    $(function () {
        //刷新项目列表
        function flushProjects() {
            ajaxRequest("post", "/api/project/listproject", {}, function (data) {
                if (data) {
                    if (data.header.code == 1000) {
                        var $projectSelect = $("#nnlightctlProjectId");

                        var projectArray = data.body.data;
                        for (var i = 0; i < projectArray.length; ++i) {
                            var project = projectArray[i];
                            $('<option value="' + project.id + '">' + project.projectName + '</option>').appendTo($projectSelect);
                        }
                    } else {
                        layer.msg(data.header.msg, {icon: 2, time: 3000});
                    }
                }
            });
        }

        flushProjects();

        //更新表单
        var id = editModel(window.location.href);
        ajaxRequest("post", "/api/roadlighting/getElebox", {"id": id}, function (data) {
            if (data) {
                if (data.header.code == 1000) {
                    var elebox = data.body.data[0];
                    //刷新表单数据
                    for (var key in elebox) {
                        $("#" + key).val(elebox[key]);
                    }
                    $("#manufacture").val(formatDate(elebox["manufacture"] ? elebox["manufacture"] : new Date().getTime()));
                    $("#useDate").val(formatDate(elebox["useDate"] ? elebox["useDate"] : new Date().getTime()));
                    //填充区域数据
                    var regionId = elebox["nnlightctlRegionId"];
                    $("#nnlightctlRegionId").attr("regionId", regionId);
                    if (regionId && regionId > 0) {
                        ajaxRequest("post", "/api/roadlighting/getAreaDescById", {"id": regionId}, function (data) {
                            if (data) {
                                if (data.header.code == 1000) {
                                    var regionDesc = data.body.data[0];
                                    $("#nnlightctlRegionId").val(regionDesc);
                                } else {
                                    layer.msg(data.header.msg, {icon: 2, time: 3000});
                                }
                            }
                        });
                    }
                } else {
                    layer.msg(data.header.msg, {icon: 2, time: 3000});
                }
            }
        });

        //注册区域文本框点击事件
        $("#nnlightctlRegionId").click(function () {
            layer_show("设置区域", "setArea.html", "600", "400", function (regionId) {
                $("#nnlightctlRegionId").attr("regionId", regionId);
                ajaxRequest("post", "/api/roadlighting/getAreaDescById", {"id": regionId}, function (data) {
                    if (data) {
                        if (data.header.code == 1000) {
                            var regionDesc = data.body.data[0];
                            $("#nnlightctlRegionId").val(regionDesc);
                        } else {
                            layer.msg(data.header.msg, {icon: 2, time: 3000});
                        }
                    }
                });
            });
        });
        
        //表单提交
        $("#form-admin-add").validate({
            rules: {
                codeNumber: {
                    required: true
                },
                nnlightctlProjectId: {
                    required: true
                }
            },
            onkeyup: false,
            focusCleanup: true,
            success: "valid",
            submitHandler: function (form) {
                //收集更新控制柜参数
                var param = {};

                var formDataArray = $(form).serializeArray();
                for (var i = 0; i < formDataArray.length; ++i) {
                    var formDataPair = formDataArray[i];
                    param[formDataPair["name"]] = formDataPair["value"];
                }
                //日期
                param["useDate"] = str2Date($("#useDate").val());
                param["manufacture"] = str2Date($("#manufacture").val());
                //区域id
                param["nnlightctlRegionId"] = $("#nnlightctlRegionId").attr("regionId");
                //id
                param["id"] = editModel(window.location.href);

                ajaxRequest("post", "/api/roadlighting/updateelebox", param, function (data) {
                        if (data) {
                            if (data.header.code == 1000) {
                                layer.msg("编辑控制柜成功！", {icon : 1, time : 3000});
                            } else {
                                layer.msg(data.header.msg, {icon : 2, time : 3000});
                            }
                        }
                    });

                ResetWindow();
            }
        });
    });
</script>
</body>
</html>
