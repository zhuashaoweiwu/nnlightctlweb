<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>能耗监测</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css?v=1" />
    <link rel="stylesheet" type="text/css" href="../css/admin.css" />
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css" />

</head>
<body>
    <nav class="breadcrumb">
        <i class="Hui-iconfont">&#xe67f;</i>
        首页<span class="c-gray en">&gt;</span>能耗分析
        <span class="c-gray en">&gt;</span>能耗监测
        <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新">
            <i class="Hui-iconfont">&#xe68f;</i>
        </a>
    </nav>
    <div class="page-container">
        <div class="text-l">
            控制柜：
            <span class="select-box inline">
                <select name="userType" id="userType" class="select">
                    <option value="-1">请选择控制柜</option>
                    <option value="0">控制柜1</option>
                    <option value="1">控制柜2</option>
                    <option value="2">控制柜3</option>
                </select>
            </span>
            <span class="pl-20">日期范围：</span>
            <input type="text" onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}' })" id="logmin" class="input-text Wdate" style="width:120px;">
            -
            <input type="text" onfocus="WdatePicker({ minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d' })" id="logmax" class="input-text Wdate" style="width:120px;">

            <button name="" id="Button1" class="btn btn-success f-r" type="submit"><i class="Hui-iconfont">&#xe665;</i>搜索</button>
        </div><!--搜索end-->
        <div id="tab-system" class="HuiTab mt-30">
            <div class="tabBar cl">
                <span>功率</span>
                <span>电流</span>
                <span>电压</span>
                <span>电能</span>
            </div>
            <div class="tabCon mt-30">
                <div id="container" style="width:96%;"></div><!--绑定功率线图end-->
            </div>
            <div class="tabCon mt-30">
                <div id="container1" style="width:96%;"></div><!--绑定电流线图end-->
            </div>
            <div class="tabCon mt-30">
                <div id="container2" style="width:96%;"></div><!--绑定电压柱状图end-->
            </div>
            <div class="tabCon mt-30">
                <div id="container3" style="width:96%;"></div><!--绑定电能线图end-->
            </div>
        </div>

        </div>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <script type="text/javascript" src="../lib/My97DatePicker/4.8/WdatePicker.js"></script> <!--日期插件-->
    <script type="text/javascript" src="../js/highcharts.js"></script> <!--图表插件-->
    <script type="text/javascript" src="../js/exporting.js"></script> <!--图表下载插件-->
    <script type="text/javascript" src="../js/api/requestRoot.js"></script>
    <script type="text/javascript" src="../js/api/ajaxScript.js"></script>
    <script type="text/javascript">
        $(function () {
            var eleboxId;
            var startDate;
            var endDate;
            $("#Button1").click(function(){
                eleboxId = $("#projectName").val();
                startDate = new Date($("#logmin").val());
                endDate = new Date($("#logmax").val());
                console.log(startDate);

                ajaxRequest("post", "/api/energyStatistic/listEleboxElectric",{"eleboxId":eleboxId,"startDate":startDate,"endDate":endDate},
                    function (data) {
                    console.log(data);
                        var categories = new Array();
                        var  ele = new Array();
                        for (var i = 0 ; i< data.body.data.length ; i++){
                            //categories[i] = data.body.data[i].realtimeDate;
                            var now = new Date(data.body.data[i].realtimeDate)
                            y = now.getFullYear(),
                                m = ("0" + (now.getMonth() + 1)).slice(-2),
                                d = ("0" + now.getDate()).slice(-2);
                            var timestamp = y + "-" + m + "-" + d + " " + now.toTimeString().substr(0, 8)
                            categories[i] = timestamp;
                            ele[i] = data.body.data[i].electricity;
                            Highcharts.chart('container1', {

                                title: {
                                    text: '电流',
                                    x: 0 //center
                                },
                                subtitle: {
                                    text: '',
                                    x: 0
                                },
                                xAxis: {
                                    categories: categories
                                },
                                yAxis: {
                                    title: {
                                        text: '电流（KW）'
                                    },
                                    plotLines: [{
                                        value: 0,
                                        width: 1,
                                        color: '#808080'
                                    }]
                                },
                                tooltip: {
                                    valueSuffix: 'KW'
                                },
                                legend: {
                                    layout: 'vertical',
                                    align: 'right',
                                    verticalAlign: 'middle',
                                    borderWidth: 0
                                },
                                series: [{
                                    name: '电流',
                                    data: ele
                                }]
                            });
                        }
                    });

            })

            ajaxRequest("post", "/api/energyStatistic/listEleboxElectric",{"eleboxId":eleboxId,"startDate":startDate,"endDate":endDate},
                function (data) {
                    var eleboxIdFirst = data.body.data[0].id;
                    ajaxRequest("post", "/api/energyStatistic/listEleboxElectric",{"eleboxId":eleboxIdFirst},
                        function (data) {
                            var categories = new Array();
                            var  ele = new Array();
                            for (var i = 0 ; i< data.body.data.length ; i++){
                                //categories[i] = data.body.data[i].realtimeDate;
                                var now = new Date(data.body.data[i].realtimeDate)
                                y = now.getFullYear(),
                                m = ("0" + (now.getMonth() + 1)).slice(-2),
                                d = ("0" + now.getDate()).slice(-2);
                                var timestamp = y + "-" + m + "-" + d + " " + now.toTimeString().substr(0, 8)
                                categories[i] = timestamp;
                                ele[i] = data.body.data[i].electricity;
                            }
                            console.log(data)
                            Highcharts.chart('container1', {

                                title: {
                                    text: '电流',
                                    x: 0 //center
                                },
                                subtitle: {
                                    text: '',
                                    x: 0
                                },
                                xAxis: {
                                    categories: categories
                                },
                                yAxis: {
                                    title: {
                                        text: '电流（KW）'
                                    },
                                    plotLines: [{
                                        value: 0,
                                        width: 1,
                                        color: '#808080'
                                    }]
                                },
                                tooltip: {
                                    valueSuffix: 'KW'
                                },
                                legend: {
                                    layout: 'vertical',
                                    align: 'right',
                                    verticalAlign: 'middle',
                                    borderWidth: 0
                                },
                                series: [{
                                    name: '电流',
                                    data: ele
                                }]
                            });
                        }
                    );
                }
            );


            //tab切换
            $("#tab-system").Huitab({
                index: 0//默认第一个；
            });
            //功率
            Highcharts.chart('container', {
               
                title: {
                    text: '',
                    x: 0 //center
                },
                subtitle: {
                    text: '',
                    x: 0
                },
                xAxis: {
                    categories: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31']
                },
                yAxis: {
                    title: {
                        text: '功率（KW）'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    valueSuffix: 'KW'
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '有功功率',
                    data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 18.2]
                }, {
                    name: '无功功率',
                    data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8, 3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
                }]
            });

           /* //电流
            Highcharts.chart('container1', {

                title: {
                    text: '电流',
                    x: 0 //center
                },
                subtitle: {
                    text: '',
                    x: 0
                },
                xAxis: {
                    categories: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31']
                },
                yAxis: {
                    title: {
                        text: '电流（KW）'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    valueSuffix: 'KW'
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '电流',
                    data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 18.2]
                }]
            });*/
            //电压
            Highcharts.chart('container2', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: '电压',
                    x: 0 //center
                },
                subtitle: {
                    text: '',
                    x: 0
                },
                xAxis: {
                    categories: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31']
                },
                yAxis: {
                    title: {
                        text: '电压（KW）'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    valueSuffix: 'KW'
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '电压',
                    data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 18.2]
                }]
            });
            //电能
            Highcharts.chart('container3', {

                title: {
                    text: '电能',
                    x: 0 //center
                },
                subtitle: {
                    text: '',
                    x: 0
                },
                xAxis: {
                    categories: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31']
                },
                yAxis: {
                    title: {
                        text: '电能（KW）'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    valueSuffix: 'KW'
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '电能',
                    data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6, 18.2]
                }]
            });
        });
    </script>

</body>
</html>
